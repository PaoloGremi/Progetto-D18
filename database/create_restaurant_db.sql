DROP SCHEMA IF EXISTS RESTAURANT ;
CREATE SCHEMA RESTAURANT;

USE RESTAURANT;

CREATE TABLE DISHES
	(
		DISH_CODE VARCHAR(3) PRIMARY KEY,
        DISH_NAME VARCHAR(60) NOT NULL,
        DISH_TYPE VARCHAR (20) NOT NULL,				-- ANTIPASTO, PRIMO, SECONDO, DOLCE
		DISH_PRICE DOUBLE NOT NULL,
        VEGAN BOOLEAN DEFAULT FALSE,					-- TRUE SE IL PIATTO E' PER VEGANI
        VEGGIE BOOLEAN DEFAULT FALSE,					-- TRUE SE IL PIATTO E' PER VEGETARIANI
        CELIAC BOOLEAN DEFAULT FALSE					-- TRUE SE IL PIATTO E' PER CELIACI
     );
     
-- INSERIMENTO ANTIPASTI
INSERT INTO DISHES VALUES('A01', 'TAGLIERE SALUMI MISTI', 'ANTIPASTO', 5, FALSE, FALSE, TRUE);
INSERT INTO DISHES VALUES('A02', 'TARTARE DI SALMONE', 'ANTIPASTO', 15, FALSE, FALSE, FALSE);
INSERT INTO DISHES VALUES('A03', 'GNOCCO FRITTO', 'ANTIPASTO', 5, FALSE, FALSE, FALSE);
INSERT INTO DISHES VALUES('A04', 'VERDURE FRITTE', 'ANTIPASTO', 4, FALSE, FALSE, FALSE);
INSERT INTO DISHES VALUES('A05', 'BRUSCHETTA CON POMODORINI', 'ANTIPASTO', 2, TRUE, FALSE, FALSE);
INSERT INTO DISHES VALUES('A06', 'TORTA SALATA', 'ANTIPASTO', 3, FALSE, FALSE, FALSE);
INSERT INTO DISHES VALUES('A07', 'TAGLIERE FORMAGGI MISTI', 'ANTIPASTO', 5, FALSE, FALSE, FALSE);
INSERT INTO DISHES VALUES('A08', 'MOZZARELLA IN CARROZZA', 'ANTIPASTO', 3, FALSE, FALSE, FALSE);
INSERT INTO DISHES VALUES('A09', 'COZZE GRATINATE', 'ANTIPASTO', 7.5, FALSE, FALSE, FALSE);
INSERT INTO DISHES VALUES('A10', 'OLIVE ASCOLANE', 'ANTIPASTO', 3, FALSE, FALSE, FALSE);
-- INSERIMENTO PRIMI
INSERT INTO DISHES VALUES('P01', 'PAELLA','PRIMO', 12.5, FALSE, FALSE, FALSE);
INSERT INTO DISHES VALUES('P02', 'SPAGHETTI ALLO SCOGLIO','PRIMO', 10, FALSE, FALSE, FALSE);
INSERT INTO DISHES VALUES('P03', 'CARBONARA','PRIMO', 8, FALSE, FALSE, FALSE);
INSERT INTO DISHES VALUES('P04', 'LASAGNA','PRIMO', 7.5, FALSE, FALSE, FALSE);
INSERT INTO DISHES VALUES('P05', 'RISOTTO E FUNGHI','PRIMO', 7, FALSE, FALSE, FALSE);
INSERT INTO DISHES VALUES('P06', 'CASSOEULA','PRIMO', 6 , FALSE, FALSE, FALSE);
-- INSERIMENTO SECONDI
INSERT INTO DISHES VALUES ('S01','ARAGOSTA','SECONDO', 20, FALSE, FALSE, TRUE);
-- INSERIMENTO DESSERT
INSERT INTO DISHES VALUES ('D01', 'CHEESECAKE','DESSERT', 5, FALSE, FALSE, FALSE);
  

CREATE TABLE ALLERGENS
	(
		ALLERGEN_CODE CHAR PRIMARY KEY,
        ALLERGEN_DESCR VARCHAR(50) NOT NULL
        
    );

-- INSERIMENTO ALLERGENI
INSERT INTO ALLERGENS VALUES ('A', 'GLUTINE');
INSERT INTO ALLERGENS VALUES ('B', 'CROSTACEI E DERIVATI');
INSERT INTO ALLERGENS VALUES ('C', 'UOVA E DERIVATI');
INSERT INTO ALLERGENS VALUES ('D', 'PESCE E DERIVATI');
INSERT INTO ALLERGENS VALUES ('E', 'ARACHIDI E DERIVATI');
INSERT INTO ALLERGENS VALUES ('F', 'SOIA E DERIVATI');
INSERT INTO ALLERGENS VALUES ('G', 'LATTE E DERIVATI');
INSERT INTO ALLERGENS VALUES ('H', 'FRUTTA A GUSCIO');
INSERT INTO ALLERGENS VALUES ('I', 'SEDANO E DERIVATI');
INSERT INTO ALLERGENS VALUES ('L', 'SENAPE E DERIVATI');
INSERT INTO ALLERGENS VALUES ('M', 'SEMI DI SESAMO E DERIVATI');
INSERT INTO ALLERGENS VALUES ('N', 'ANIDRIDE SOLVOROSA E SOLFITI');
INSERT INTO ALLERGENS VALUES ('O', 'LUPINO E DERIVATI');
INSERT INTO ALLERGENS VALUES ('P', 'MOLLUSCHI E DERIVATI');
    

CREATE TABLE INGREDIENTS
	(
		INGREDIENT_CODE VARCHAR(3) PRIMARY KEY,
        INGREDIENT_NAME VARCHAR(50) NOT NULL
		
    );

    

    
CREATE TABLE ALLERGENS_IN_DISHES
	(
		ALLERGEN_CODE CHAR,
        DISH_CODE VARCHAR(3),
		PRIMARY KEY(ALLERGEN_CODE, DISH_CODE),
        FOREIGN KEY (DISH_CODE) REFERENCES DISHES(DISH_CODE),
		FOREIGN KEY (ALLERGEN_CODE) REFERENCES ALLERGENS(ALLERGEN_CODE)
		
    );

CREATE TABLE INGREDIENTS_IN_DISHES
	(
		INGREDIENT_CODE VARCHAR(3),
        DISH_CODE VARCHAR(3),
        PRIMARY KEY (INGREDIENT_CODE, DISH_CODE),
        FOREIGN KEY (DISH_CODE) REFERENCES DISHES(DISH_CODE),
		FOREIGN KEY (INGREDIENT_CODE) REFERENCES INGREDIENTS(INGREDIENT_CODE)
        
    );
    

    

CREATE VIEW STARTERS AS(

	SELECT DISH_CODE, DISH_NAME, DISH_TYPE, DISH_PRICE,  CASE 
                  WHEN VEGAN = TRUE 
                     THEN 'YES' 
                  ELSE 'NO'
             END  as VEGAN, 
             CASE 
                  WHEN VEGGIE=TRUE 
                     THEN 'YES' 
                  ELSE 'NO'
             END  as VEGGIE, 
             CASE 
                  WHEN CELIAC=TRUE
                     THEN 'YES'
                  ELSE 'NO' 
             END  as CELIAC
    FROM DISHES
    WHERE DISH_TYPE='ANTIPASTO'

);
CREATE VIEW FIRST_COURSES AS(

	SELECT DISH_CODE, DISH_NAME, DISH_TYPE, DISH_PRICE,  CASE 
                  WHEN VEGAN = TRUE 
                     THEN 'YES' 
                  ELSE 'NO'
             END  as VEGAN, 
             CASE 
                  WHEN VEGGIE=TRUE 
                     THEN 'YES' 
                  ELSE 'NO'
             END  as VEGGIE, 
             CASE 
                  WHEN CELIAC=TRUE
                     THEN 'YES'
                  ELSE 'NO' 
             END  as CELIAC
    FROM DISHES
    WHERE DISH_TYPE='PRIMO'
);
CREATE VIEW MAIN_COURSES AS(

	SELECT DISH_CODE, DISH_NAME, DISH_TYPE, DISH_PRICE,  CASE 
                  WHEN VEGAN = TRUE 
                     THEN 'YES' 
                  ELSE 'NO'
             END  as VEGAN, 
             CASE 
                  WHEN VEGGIE=TRUE 
                     THEN 'YES' 
                  ELSE 'NO'
             END  as VEGGIE, 
             CASE 
                  WHEN CELIAC=TRUE
                     THEN 'YES'
                  ELSE 'NO' 
             END  as CELIAC
    FROM DISHES
    WHERE DISH_TYPE='SECONDO'
);
CREATE VIEW DESSERTS AS(

	SELECT DISH_CODE, DISH_NAME, DISH_TYPE, DISH_PRICE,  CASE 
                  WHEN VEGAN = TRUE 
                     THEN 'YES' 
                  ELSE 'NO'
             END  as VEGAN, 
             CASE 
                  WHEN VEGGIE=TRUE 
                     THEN 'YES' 
                  ELSE 'NO'
             END  as VEGGIE, 
             CASE 
                  WHEN CELIAC=TRUE
                     THEN 'YES'
                  ELSE 'NO' 
             END  as CELIAC
    FROM DISHES
    WHERE DISH_TYPE='DESSERT'
);






